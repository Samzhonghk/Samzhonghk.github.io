
<!DOCTYPE HTML>
<html>
<head>
	<script data-cfasync="false" type="text/javascript" src="//use.typekit.net/axj3cfp.js"></script>
	<script data-cfasync="false" type="text/javascript">try{Typekit.load();}catch(e){}</script>
	<meta charset="utf-8">
	<title>Fifth Day of Music Store Project(SamMusicStore)  | Sam Zhong</title>

<meta name="author" content="Sam Zhong"> 

<meta name="description" content="In the past a few days, I was trying to load the data from database and displaying it. Now I will also enable editing the data. Now I will create a &hellip;"> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Sam Zhong" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="/javascripts/jquery.fancybox.pack.js"></script>

<script language="Javascript" type="text/javascript">
$(document).ready(
  function() {
    (function($) {
      $(".fancybox[data-content-id]").each(function() {
        this.href = $(this).data('content-id');
      });
      $(".fancybox").fancybox({
        beforeLoad: function() {
          var el, 
              id = $(this.element).data('title-id');

          if (id) {
            el = $('#' + id);

            if (el.length) {
              this.title = el.html();
            }
          }
          if ($(this).data('content')) {
            this.content = $(this).data('content');
          }
        },
        helpers: {
          title: {
            type: 'inside'
          }
        }
      });
    })(jQuery);
  }
);
</script>

	
</head>



<body>
	<header id="header" class="inner"><h1><a href="/">Sam Zhong</a></h1>
<h4>Intern developer who is passionated with Web Application and Mobile Application</h4>
<nav id="main-nav"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/about">About</a></li>
	<li><a href="/portfolio">Portfolio</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/about">About</a></li>
	<li><a href="/portfolio">Portfolio</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:samzhonghk.github.io">
			</form>
		</div>
	</div>
</nav>


</header>

	<div id="content" class="inner"><article class="post">
	<h2 class="title">Fifth Day of Music Store Project(SamMusicStore)</h2>
	<div class="entry-content"><!--more-->


<h3>In the past a few days, I was trying to load the data from database and displaying it. Now I will also enable editing the data.</h3>

<h3>Now I will create a new controller called StoreManagerController. For this controller, I will be taking advantage of the Scaffolding features available in the ASP.NET MVC Tools Update. Set the options for the Add Controller dialog as shown below.</h3>

<h3>When I click the Add button, you’ll see that the ASP.NET MVC scaffolding mechanism does a good amount of work:</h3>

<p>-It creates the new StoreManagerController with a local Entity Framework variable
-It adds a StoreManager folder to the project’s Views folder
-It adds Create.cshtml, Delete.cshtml, Details.cshtml, Edit.cshtml, and Index.cshtml view, strongly typed to the Album class
<img class="left" src="/images/SamMvc/storeManagerController.jpg" width="650" height="650" title="'Store Manager Controller'" ></p>

<h5>The new StoreManager controller class includes CRUD (create, read, update, delete) controller actions which know how to work with the Album model class and use our Entity Framework context for database access.</h5>

<h4>Start with a quick edit to the StoreManager Index view (/Views/StoreManager/Index.cshtml). This view will display a table which lists the Albums in our store with Edit / Details / Delete links, and includes the Album’s public properties. I will remove the AlbumArtUrl field, as it’s not very useful in this display. In <table> section of the view code, remove the th and td elements surrounding AlbumArtUrl references</h4>

<h3>First Look at the Store Manager</h3>

<p><img class="left" src="/images/SamMvc/indexListDisplay.jpg" width="650" height="650" title="'Index List Display'" ></p>

<h4>To click the Edit link displays an edit form with fields for the Album, including dropdowns for Genres and Artist.</h4>

<p><img class="left" src="/images/SamMvc/editAlbum.jpg" width="650" height="650" title="'Edit Album'" ></p>

<h4>Click the “Back to List” link at the bottom, then click on the Details link for an Album. This displays the detail information for an individual Album.</h4>

<p><img class="left" src="/images/SamMvc/detailsAlbum.jpg" width="550" height="550" title="'Details Album'" ></p>

<h4>Again, click the Back to List link, then click on a Delete link. This displays a confirmation dialog, showing the album details and asking if sure I want to delete it.</h4>

<p><img class="left" src="/images/SamMvc/deleteAlbum.jpg" width="550" height="550" title="'Delete Album'" ></p>

<h4>Clicking the Delete button at the bottom will delete the album and return to the Index page, which shows the album deleted.</h4>

<h4>The index view retrieves a list of Albums, including each album’s referenced Genre and Artist information, as I previously saw when working on the Store Browse method. The Index view is following the references to the linked objects so that it can display each album’s Genre name and Artist name, so the controller is being efficient and querying for this information in the original request.</h4>

<p><img class="left" src="/images/SamMvc/storeManagerControllerIndex.jpg" width="550" height="550" title="'StoreManager Controller Index'" ></p>

<h4>The StoreManager Controller’s Details controller action works exactly the same as the Store Controller Details action I wrote previously - it queries for the Album by ID using the Find() method, then returns it to the view.</h4>

<p><img class="left" src="/images/SamMvc/StoreManagerControllerDetails.jpg" width="550" height="550" title="'StoreManager Controller Details'" ></p>

<h3>The Create Action Methods</h3>

<h5>When a user first visits /StoreManager/Create/ they will be shown an empty form. This HTML page will contain a <form> element that contains dropdown and textbox input elements where they can enter the album’s details.</h5>

<h5>After the user fills in the Album form values, they can press the “Save” button to submit these changes back to our application to save within the database. When the user presses the “save” button the <form> will perform an HTTP-POST back to the /StoreManager/Create/ URL and submit the <form> values as part of the HTTP-POST.</h5>

<h4>The ViewBag</h4>

<h5>The ViewBag is a dynamic object, meaning that you can type ViewBag.Foo or ViewBag.YourNameHere without writing code to define those properties. In this case, the controller code uses ViewBag.GenreId and ViewBag.ArtistId so that the dropdown values submitted with the form will be GenreId and ArtistId, which are the Album properties they will be setting.</h5>

<h4>The HTTP-GET Create action is pretty simple - two SelectLists are added to the ViewBag, and no model object is passed to the form (since it hasn’t been created yet).</h4>

<p><img class="left" src="/images/SamMvc/storeManagerControllerCreate.jpg" width="650" height="650" title="'StoreManager Controlle Create method'" ></p>

<h5>This action has four responsibilities:</h5>

<p>1.Read the form values
2.Check if the form values pass any validation rules
3.if the form submission is valid, save the data and display the updated list
4.If the form submission is not valid, redisplay the form with validation errors.</p>

<h5>The controller action is processing a form submission that includes values for GenreId and ArtistId (from the drop down list) and textbox values for Title, Price, and AlbumArtUrl. While it’s possible to directly access form values, a better approach is to use the Model Binding capabilities built into ASP.NET MVC. When a controller action takes a model type as a parameter, ASP.NET MVC will attempt to populate an object of that type using form inputs (as well as route and querystring values). It does this by looking for values whose names match properties of the model object, e.g. when setting the new Album object’s GenreId value, it looks for an input with the name GenreId. When you create views using the standard methods in ASP.NET MVC, the forms will always be rendered using property names as input field names, so this the field names will just match up.</h5>

<h4>Saving the submitted values</h4>

<h5>If the form submission passes validation, it’s time to save the values to the database. With Entity Framework, that just requires adding the model to the Albums collection and calling SaveChanges.</h5>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='C#'><span class='line'><span class="n">db</span><span class="p">.</span><span class="n">Album</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">album</span><span class="p">);</span>
</span><span class='line'><span class="n">db</span><span class="p">.</span><span class="n">SaveChanges</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>Entity Framework generates the appropriate SQL commands to persist the value. After saving the data, we redirect back to the list of Albums so we can see our update. This is done by returning RedirectToAction with the name of the controller action we want displayed. In this case, that’s the Index method.</p></blockquote>

<h4>Now I will test the Create form</h4>

<p><img class="left" src="/images/SamMvc/CreateAlbumViewAfterValidation.jpg" width="550" height="550" title="'Create Album View After Validation'" ></p>

<h4>Deletion follows the same pattern as Edit and Create, using one controller action to display the confirmation form, and another controller action to handle the form submission.</h4>

<p><img class="left" src="/images/SamMvc/deleteComfirmSubmit.jpg" width="550" height="550" title="''" ></p>

<h4>Display a form that’s strongly typed to an Album type, using the Delete view content template.</h4>

<p><img class="left" src="/images/SamMvc/deleteAlbum.jpg" width="550" height="550" title="'Delete Album'" ></p>

<h4>Clicking the Delete button causes the form to be posted back to the server, which executes the DeleteConfirmed action.</h4>

<p><img class="left" src="/images/SamMvc/deleteComfirmMethod.jpg" width="550" height="550" title="'Delete Comfirm Method'" ></p>

<h5>HTTP-POST Delete Controller Action takes the following actions:</h5>

<p>1.Loads the Album by ID
2.Deletes it the album and save changes
3.Redirects to the Index, showing that the Album was removed from the list</p>

<h4>The updated screen will be displayed after the confirmation.</h4>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-09-25T16:07:19+13:00" pubdate data-updated="true"></time></div>
	


	
</div></article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
<!---	<a class="addthis_counter addthis_pill_style"></a> --->
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
	<footer id="footer" class="inner">Copyright &copy; 2016

    Sam Zhong

<br>
Powered by Octopress.
</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>
